/* mjs v0.0.3
 * Lucas Doyle <lucas.p.doyle@gmail.com>
 * built on 2014-02-26 
 */
define([],function(){const a=Float64Array;var b={};b._temp1=new a(3),b._temp2=new a(3),b._temp3=new a(3),a==Array?(b.x=[1,0,0],b.y=[0,1,0],b.z=[0,0,1],b.$=function(a,b,c){return[a,b,c]},b.clone=function(a){return[a[0],a[1],a[2]]}):(b.x=new a([1,0,0]),b.y=new a([0,1,0]),b.z=new a([0,0,1]),b.$=function(b,c,d){return new a([b,c,d])},b.clone=function(b){return new a(b)}),b.u=b.x,b.v=b.y,b.add=function(b,c,d){return void 0==d&&(d=new a(3)),d[0]=b[0]+c[0],d[1]=b[1]+c[1],d[2]=b[2]+c[2],d},b.sub=function(b,c,d){return void 0==d&&(d=new a(3)),d[0]=b[0]-c[0],d[1]=b[1]-c[1],d[2]=b[2]-c[2],d},b.neg=function(b,c){return void 0==c&&(c=new a(3)),c[0]=-b[0],c[1]=-b[1],c[2]=-b[2],c},b.direction=function(c,d,e){return void 0==e&&(e=new a(3)),b.normalize(b.sub(c,d,e),e)},b.length=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},b.lengthSquared=function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},b.normalize=function(c,d){void 0==d&&(d=new a(3));var e=1/b.length(c);return d[0]=c[0]*e,d[1]=c[1]*e,d[2]=c[2]*e,d},b.scale=function(b,c,d){return void 0==d&&(d=new a(3)),d[0]=b[0]*c,d[1]=b[1]*c,d[2]=b[2]*c,d},b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},b.cross=function(b,c,d){return void 0==d&&(d=new a(3)),d[0]=b[1]*c[2]-b[2]*c[1],d[1]=b[2]*c[0]-b[0]*c[2],d[2]=b[0]*c[1]-b[1]*c[0],d},b.mul4x4=function(c,d,e){var f,g=b._temp1;return void 0==e&&(e=new a(3)),g[0]=c[3],g[1]=c[7],g[2]=c[11],f=b.dot(d,g)+c[15],g[0]=c[0],g[1]=c[4],g[2]=c[8],e[0]=(b.dot(d,g)+c[12])/f,g[0]=c[1],g[1]=c[5],g[2]=c[9],e[1]=(b.dot(d,g)+c[13])/f,g[0]=c[2],g[1]=c[6],g[2]=c[10],e[2]=(b.dot(d,g)+c[14])/f,e};var c={};c._temp1=new a(16),c._temp2=new a(16),a==Array?(c.I=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c.$=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]},c.clone=function(a){return new[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}):(c.I=new a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c.$=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return new a([b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q])},c.clone=function(b){return new a(b)}),c.identity=c.I,c.topLeft3x3=function(b,c){return void 0==c&&(c=new a(9)),c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[4],c[4]=b[5],c[5]=b[6],c[6]=b[8],c[7]=b[9],c[8]=b[10],c},c.inverseOrthonormal=function(d,e){void 0==e&&(e=new a(16)),c.transpose(d,e);var f=[d[12],d[13],d[14]];return e[3]=e[7]=e[11]=0,e[12]=-b.dot([e[0],e[4],e[8]],f),e[13]=-b.dot([e[1],e[5],e[9]],f),e[14]=-b.dot([e[2],e[6],e[10]],f),e},c.inverseTo3x3=function(b,c){void 0==c&&(c=new a(9));var d=b[10]*b[5]-b[6]*b[9],e=-b[10]*b[1]+b[2]*b[9],f=b[6]*b[1]-b[2]*b[5],g=-b[10]*b[4]+b[6]*b[8],h=b[10]*b[0]-b[2]*b[8],i=-b[6]*b[0]+b[2]*b[4],j=b[9]*b[4]-b[5]*b[8],k=-b[9]*b[0]+b[1]*b[8],l=b[5]*b[0]-b[1]*b[4],m=b[0]*d+b[1]*g+b[2]*j;if(0==m)throw"matrix not invertible";var n=1/m;return c[0]=n*d,c[1]=n*e,c[2]=n*f,c[3]=n*g,c[4]=n*h,c[5]=n*i,c[6]=n*j,c[7]=n*k,c[8]=n*l,c},c.makeFrustum=function(b,c,d,e,f,g,h){void 0==h&&(h=new a(16));return h[0]=2*f/(c-b),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*f/(e-d),h[6]=0,h[7]=0,h[8]=(c+b)/(c-b),h[9]=(e+d)/(e-d),h[10]=-(g+f)/(g-f),h[11]=-1,h[12]=0,h[13]=0,h[14]=-2*g*f/(g-f),h[15]=0,h},c.makePerspective=function(a,b,d,e,f){var g=d*Math.tan(a*Math.PI/360),h=-g,i=h*b,j=g*b;return c.makeFrustum(i,j,h,g,d,e,f)},c.makeOrtho=function(b,c,d,e,f,g,h){void 0==h&&(h=new a(16));return h[0]=2/(c-b),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/(e-d),h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=-2/(g-f),h[11]=0,h[12]=-(c+b)/(c-b),h[13]=-(e+d)/(e-d),h[14]=-(g+f)/(g-f),h[15]=1,h},c.makeOrtho2D=function(a,b,d,e,f){return c.makeOrtho(a,b,d,e,-1,1,f)},c.mul=function(b,c,d){void 0==d&&(d=new a(16));var e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],k=b[6],l=b[7],m=b[8],n=b[9],o=b[10],p=b[11],q=b[12],r=b[13],s=b[14],t=b[15],u=c[0],v=c[1],w=c[2],x=c[3],y=c[4],z=c[5],A=c[6],B=c[7],C=c[8],D=c[9],E=c[10],F=c[11],G=c[12],H=c[13],I=c[14],J=c[15];return d[0]=e*u+i*v+m*w+q*x,d[1]=f*u+j*v+n*w+r*x,d[2]=g*u+k*v+o*w+s*x,d[3]=h*u+l*v+p*w+t*x,d[4]=e*y+i*z+m*A+q*B,d[5]=f*y+j*z+n*A+r*B,d[6]=g*y+k*z+o*A+s*B,d[7]=h*y+l*z+p*A+t*B,d[8]=e*C+i*D+m*E+q*F,d[9]=f*C+j*D+n*E+r*F,d[10]=g*C+k*D+o*E+s*F,d[11]=h*C+l*D+p*E+t*F,d[12]=e*G+i*H+m*I+q*J,d[13]=f*G+j*H+n*I+r*J,d[14]=g*G+k*H+o*I+s*J,d[15]=h*G+l*H+p*I+t*J,d},c.mulOffset=function(a,b,c,d){var e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return c[d+0]=a11*t+h*u+l*v+p*w,c[d+1]=e*t+i*u+m*v+q*w,c[d+2]=f*t+j*u+n*v+r*w,c[d+3]=g*t+k*u+o*v+s*w,c[d+4]=a11*x+h*y+l*z+p*A,c[d+5]=e*x+i*y+m*z+q*A,c[d+6]=f*x+j*y+n*z+r*A,c[d+7]=g*x+k*y+o*z+s*A,c[d+8]=a11*B+h*C+l*D+p*E,c[d+9]=e*B+i*C+m*D+q*E,c[d+10]=f*B+j*C+n*D+r*E,c[d+11]=g*B+k*C+o*D+s*E,c[d+12]=a11*F+h*G+l*H+p*I,c[d+13]=e*F+i*G+m*H+q*I,c[d+14]=f*F+j*G+n*H+r*I,c[d+15]=g*F+k*G+o*H+s*I,c},c.mulAffine=function(b,c,d){void 0==d&&(d=new a(16));var e=b[0],f=b[1],g=b[2],h=b[4],i=b[5],j=b[6],k=b[8],l=b[9],m=b[10],n=b[12],o=b[13],p=b[14],q=c[0],r=c[1],s=c[2],t=c[4],u=c[5],v=c[6],w=c[8],x=c[9],y=c[10],z=c[12],A=c[13],B=c[14];return d[0]=e*q+h*r+k*s,d[1]=f*q+i*r+l*s,d[2]=g*q+j*r+m*s,d[3]=0,d[4]=e*t+h*u+k*v,d[5]=f*t+i*u+l*v,d[6]=g*t+j*u+m*v,d[7]=0,d[8]=e*w+h*x+k*y,d[9]=f*w+i*x+l*y,d[10]=g*w+j*x+m*y,d[11]=0,d[12]=e*z+h*A+k*B+n,d[13]=f*z+i*A+l*B+o,d[14]=g*z+j*A+m*B+p,d[15]=1,d},c.mulAffine=function(b,c,d,e){void 0==d&&(d=new a(16));var f=b[0],g=b[1],h=b[2],i=b[4],j=b[5],k=b[6],l=b[8],m=b[9],n=b[10],o=b[12],p=b[13],q=b[14],r=c[0],s=c[1],t=c[2],u=c[4],v=c[5],w=c[6],x=c[8],y=c[9],z=c[10],A=c[12],B=c[13],C=c[14];return d[e+0]=f*r+i*s+l*t,d[e+1]=g*r+j*s+m*t,d[e+2]=h*r+k*s+n*t,d[e+3]=0,d[e+4]=f*u+i*v+l*w,d[e+5]=g*u+j*v+m*w,d[e+6]=h*u+k*v+n*w,d[e+7]=0,d[e+8]=f*x+i*y+l*z,d[e+9]=g*x+j*y+m*z,d[e+10]=h*x+k*y+n*z,d[e+11]=0,d[e+12]=f*A+i*B+l*C+o,d[e+13]=g*A+j*B+m*C+p,d[e+14]=h*A+k*B+n*C+q,d[e+15]=1,d},c.makeRotate=function(c,d,e){void 0==e&&(e=new a(16)),d=b.normalize(d,b._temp1);var f=d[0],g=d[1],h=d[2],i=Math.cos(c),j=1-i,k=Math.sin(c);return e[0]=f*f*j+i,e[1]=g*f*j+h*k,e[2]=h*f*j-g*k,e[3]=0,e[4]=f*g*j-h*k,e[5]=g*g*j+i,e[6]=g*h*j+f*k,e[7]=0,e[8]=f*h*j+g*k,e[9]=g*h*j-f*k,e[10]=h*h*j+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.rotate=function(b,c,d,e){void 0==e&&(e=new a(16));var f=c[0],g=c[1],h=c[2],i=Math.sqrt(f*f+g*g+h*h),j=f,k=g,l=h;if(1!=i){var m=1/i;j*=m,k*=m,l*=m}var n=Math.cos(b),o=1-n,p=Math.sin(b),q=j*p,r=k*p,s=l*p,t=j*k*o,u=j*l*o,v=k*l*o,w=d[0],x=d[1],y=d[2],z=d[3],A=d[4],B=d[5],C=d[6],D=d[7],E=d[8],F=d[9],G=d[10],H=d[11],I=j*j*o+n,J=t+s,K=u-r,L=t-s,M=k*k*o+n,N=v+q,O=u+r,P=v-q,Q=l*l*o+n;return e[0]=w*I+A*J+E*K,e[1]=x*I+B*J+F*K,e[2]=y*I+C*J+G*K,e[3]=z*I+D*J+H*K,e[4]=w*L+A*M+E*N,e[5]=x*L+B*M+F*N,e[6]=y*L+C*M+G*N,e[7]=z*L+D*M+H*N,e[8]=w*O+A*P+E*Q,e[9]=x*O+B*P+F*Q,e[10]=y*O+C*P+G*Q,e[11]=z*O+D*P+H*Q,e!=d&&(e[12]=d[12],e[13]=d[13],e[14]=d[14],e[15]=d[15]),e},c.makeScale3=function(b,c,d,e){return void 0==e&&(e=new a(16)),e[0]=b,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.makeScale1=function(a,b){return c.makeScale3(a,a,a,b)},c.makeScale=function(a,b){return c.makeScale3(a[0],a[1],a[2],b)},c.scale3=function(b,c,d,e,f){return f==e?(e[0]*=b,e[1]*=b,e[2]*=b,e[3]*=b,e[4]*=c,e[5]*=c,e[6]*=c,e[7]*=c,e[8]*=d,e[9]*=d,e[10]*=d,e[11]*=d,e):(void 0==f&&(f=new a(16)),f[0]=e[0]*b,f[1]=e[1]*b,f[2]=e[2]*b,f[3]=e[3]*b,f[4]=e[4]*c,f[5]=e[5]*c,f[6]=e[6]*c,f[7]=e[7]*c,f[8]=e[8]*d,f[9]=e[9]*d,f[10]=e[10]*d,f[11]=e[11]*d,f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15],f)},c.scale1=function(b,c,d){return d==c?(c[0]*=b,c[1]*=b,c[2]*=b,c[3]*=b,c[4]*=b,c[5]*=b,c[6]*=b,c[7]*=b,c[8]*=b,c[9]*=b,c[10]*=b,c[11]*=b,c):(void 0==d&&(d=new a(16)),d[0]=c[0]*b,d[1]=c[1]*b,d[2]=c[2]*b,d[3]=c[3]*b,d[4]=c[4]*b,d[5]=c[5]*b,d[6]=c[6]*b,d[7]=c[7]*b,d[8]=c[8]*b,d[9]=c[9]*b,d[10]=c[10]*b,d[11]=c[11]*b,d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15],d)},c.scale=function(b,c,d){var e=b[0],f=b[1],g=b[2];return d==c?(c[0]*=e,c[1]*=e,c[2]*=e,c[3]*=e,c[4]*=f,c[5]*=f,c[6]*=f,c[7]*=f,c[8]*=g,c[9]*=g,c[10]*=g,c[11]*=g,c):(void 0==d&&(d=new a(16)),d[0]=c[0]*e,d[1]=c[1]*e,d[2]=c[2]*e,d[3]=c[3]*e,d[4]=c[4]*f,d[5]=c[5]*f,d[6]=c[6]*f,d[7]=c[7]*f,d[8]=c[8]*g,d[9]=c[9]*g,d[10]=c[10]*g,d[11]=c[11]*g,d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15],d)},c.makeTranslate3=function(b,c,d,e){return void 0==e&&(e=new a(16)),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=b,e[13]=c,e[14]=d,e[15]=1,e},c.makeTranslate1=function(a,b){return c.makeTranslate3(a,a,a,b)},c.makeTranslate=function(a,b){return c.makeTranslate3(a[0],a[1],a[2],b)},c.translate3Self=function(a,b,c,d){return d[12]+=d[0]*a+d[4]*b+d[8]*c,d[13]+=d[1]*a+d[5]*b+d[9]*c,d[14]+=d[2]*a+d[6]*b+d[10]*c,d[15]+=d[3]*a+d[7]*b+d[11]*c,d},c.translate3=function(b,c,d,e,f){if(f==e)return e[12]+=e[0]*b+e[4]*c+e[8]*d,e[13]+=e[1]*b+e[5]*c+e[9]*d,e[14]+=e[2]*b+e[6]*c+e[10]*d,e[15]+=e[3]*b+e[7]*c+e[11]*d,e;void 0==f&&(f=new a(16));var g=e[0],h=e[1],i=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=e[7],o=e[8],p=e[9],q=e[10],r=e[11];return f[0]=g,f[1]=h,f[2]=i,f[3]=j,f[4]=k,f[5]=l,f[6]=m,f[7]=n,f[8]=o,f[9]=p,f[10]=q,f[11]=r,f[12]=g*b+k*c+o*d+e[12],f[13]=h*b+l*c+p*d+e[13],f[14]=i*b+m*c+q*d+e[14],f[15]=j*b+n*c+r*d+e[15],f},c.translate1=function(a,b,d){return c.translate3(a,a,a,b,d)},c.translateSelf=function(a,b){var c=a[0],d=a[1],e=a[2];return b[12]+=b[0]*c+b[4]*d+b[8]*e,b[13]+=b[1]*c+b[5]*d+b[9]*e,b[14]+=b[2]*c+b[6]*d+b[10]*e,b[15]+=b[3]*c+b[7]*d+b[11]*e,b},c.translate=function(b,c,d){var e=b[0],f=b[1],g=b[2];if(d==c)return c[12]+=c[0]*e+c[4]*f+c[8]*g,c[13]+=c[1]*e+c[5]*f+c[9]*g,c[14]+=c[2]*e+c[6]*f+c[10]*g,c[15]+=c[3]*e+c[7]*f+c[11]*g,c;void 0==d&&(d=new a(16));var h=c[0],i=c[1],j=c[2],k=c[3],l=c[4],m=c[5],n=c[6],o=c[7],p=c[8],q=c[9],r=c[10],s=c[11];return d[0]=h,d[1]=i,d[2]=j,d[3]=k,d[4]=l,d[5]=m,d[6]=n,d[7]=o,d[8]=p,d[9]=q,d[10]=r,d[11]=s,d[12]=h*e+l*f+p*g+c[12],d[13]=i*e+m*f+q*g+c[13],d[14]=j*e+n*f+r*g+c[14],d[15]=k*e+o*f+s*g+c[15],d},c.makeLookAt=function(d,e,f,g){var h=b.direction(d,e,b._temp1),i=b.normalize(b.cross(f,h,b._temp2),b._temp2),j=b.normalize(b.cross(h,i,b._temp3),b._temp3),k=c._temp1,l=c._temp2;return k[0]=i[0],k[1]=j[0],k[2]=h[0],k[3]=0,k[4]=i[1],k[5]=j[1],k[6]=h[1],k[7]=0,k[8]=i[2],k[9]=j[2],k[10]=h[2],k[11]=0,k[12]=0,k[13]=0,k[14]=0,k[15]=1,l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=-d[0],l[13]=-d[1],l[14]=-d[2],l[15]=1,void 0==g&&(g=new a(16)),c.mul(k,l,g)},c.transposeSelf=function(a){var b=a[1];return a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,a},c.transpose=function(b,c){if(b==c){var d=0;return d=b[1],b[1]=b[4],b[4]=d,d=b[2],b[2]=b[8],b[8]=d,d=b[3],b[3]=b[12],b[12]=d,d=b[6],b[6]=b[9],b[9]=d,d=b[7],b[7]=b[13],b[13]=d,d=b[11],b[11]=b[14],b[14]=d,b}return void 0==c&&(c=new a(16)),c[0]=b[0],c[1]=b[4],c[2]=b[8],c[3]=b[12],c[4]=b[1],c[5]=b[5],c[6]=b[9],c[7]=b[13],c[8]=b[2],c[9]=b[6],c[10]=b[10],c[11]=b[14],c[12]=b[3],c[13]=b[7],c[14]=b[11],c[15]=b[15],c},c.transformPoint=function(b,c,d){void 0==d&&(d=new a(3));var e=c[0],f=c[1],g=c[2];d[0]=b[0]*e+b[4]*f+b[8]*g+b[12],d[1]=b[1]*e+b[5]*f+b[9]*g+b[13],d[2]=b[2]*e+b[6]*f+b[10]*g+b[14];var h=b[3]*e+b[7]*f+b[11]*g+b[15];return 1!=h&&(d[0]/=h,d[1]/=h,d[2]/=h),d},c.transformLine=function(b,c,d){void 0==d&&(d=new a(3));var e=c[0],f=c[1],g=c[2];d[0]=b[0]*e+b[4]*f+b[8]*g,d[1]=b[1]*e+b[5]*f+b[9]*g,d[2]=b[2]*e+b[6]*f+b[10]*g;var h=b[3]*e+b[7]*f+b[11]*g;return 1!=h&&(d[0]/=h,d[1]/=h,d[2]/=h),d},c.transformPointAffine=function(b,c,d){void 0==d&&(d=new a(3));var e=c[0],f=c[1],g=c[2];return d[0]=b[0]*e+b[4]*f+b[8]*g+b[12],d[1]=b[1]*e+b[5]*f+b[9]*g+b[13],d[2]=b[2]*e+b[6]*f+b[10]*g+b[14],d},c.transformLineAffine=function(b,c,d){void 0==d&&(d=new a(3));var e=c[0],f=c[1],g=c[2];return d[0]=b[0]*e+b[4]*f+b[8]*g,d[1]=b[1]*e+b[5]*f+b[9]*g,d[2]=b[2]*e+b[6]*f+b[10]*g,d};var d={FLOAT_ARRAY_TYPE:a,V3:b,M4x4:c};return d});